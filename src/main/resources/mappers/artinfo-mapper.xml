<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ArtInfo">

   <resultMap type="ArtInfo" id="artInfoRM">
      <id property="artinfoNum" column="artinfo_num"/>
      <result property="artistNum" column="artist_num"/>
      <result property="artinfoName" column="artinfo_name"/>
      <result property="artinfoYear" column="artinfo_year"/>
      <result property="artinfoTrend" column="artinfo_trend"/>
      <result property="artinfoKind" column="artinfo_kind"/>
      <result property="artinfoTechnic" column="artinfo_technic"/>
      <result property="artinfoSize" column="artinfo_size"/>
      <result property="artinfoCollection" column="artinfo_collection"/>
      <result property="artinfoDetail" column="artinfo_detail"/>
      <result property="artinfoDate" column="artinfo_date"/>
      <result property="artinfoImg" column="artinfo_img"/>
   </resultMap>

	<resultMap type="ArtInfo" id="myGalleryArtList">
	   <result property="artinfoImg" column="artinfo_img"/>
	   <result property="artinfoNum" column="artinfo_num"/>
	    <result property="artLikeCount" column="art_like_count"/>
	    <result property="artCommentCount" column="ART_COMMENT_COUNT"/>
	    <result property="artLikeUserId" column="id"/>
	</resultMap>
	
	<resultMap type="ArtInfo" id="artistProfileArtInfoList">
	   <result property="artinfoImg" column="artinfo_img"/>
	   <result property="artinfoNum" column="artinfo_num"/>
	    <result property="artLikeCount" column="art_like_count"/>
	    <result property="artCommentCount" column="ART_COMMENT_COUNT"/>
	</resultMap>
	
	<resultMap type="ArtInfo" id="artInfoDetailRM">
	  <id property="artinfoNum" column="artinfo_num"/>
      <result property="artistNum" column="artist_num"/>
      <result property="artinfoName" column="artinfo_name"/>
      <result property="artinfoYear" column="artinfo_year"/>
      <result property="artinfoTrend" column="artinfo_trend"/>
      <result property="artinfoKind" column="artinfo_kind"/>
      <result property="artinfoTechnic" column="artinfo_technic"/>
      <result property="artinfoSize" column="artinfo_size"/>
      <result property="artinfoCollection" column="artinfo_collection"/>
      <result property="artinfoDetail" column="artinfo_detail"/>
      <result property="artinfoDate" column="artinfo_date"/>
      <result property="artinfoImg" column="artinfo_img"/>
      <association property="artist" column="artist_num" javaType="Artist">
      		   <result property="artistName" column="artist_name"/>
			   <result property="artistIntro" column="artist_intro"/>
			   <result property="artistCountry" column="artist_country"/>
			   <result property="artistGender" column="artist_gender"/>
			   <result property="artistBirth" column="artist_birth"/>
			   <result property="artistDead" column="artist_dead"/>
			   <result property="artistImg" column="artist_img"/>
			   <result property="artistDetail" column="artist_detail"/>
      </association>
	</resultMap>
	
	<resultMap type="ArtComment" id="artCommentRM">
      <id property="art_comment_num" column="art_comment_num"/>
      <result property="art_num" column="art_num"/>
      <result property="id" column="id"/>
      <result property="art_comment" column="art_comment"/>
      <result property="art_comment_class" column="art_comment_class"/>
      <result property="art_comment_group" column="art_comment_group"/>
      <result property="art_comment_date" column="art_comment_date"/>
	  <result property="member_img" column="member_img"/>
	</resultMap>
	
   <select id="myGalleryArtList" resultMap="myGalleryArtList" parameterType="hashmap">
		<![CDATA[
		select * from (   select Rownum r, t1.* from (
		SELECT A.ARTINFO_IMG, COUNT_TABLE.*
		FROM ART_INFO A
		JOIN 
		(SELECT A.ARTINFO_NUM, A.ART_LIKE_COUNT, B.ART_COMMENT_COUNT, A.ID
		FROM
		(SELECT S.ARTINFO_NUM, S.ID, COUNT(ART_LIKE_NUM) ART_LIKE_COUNT
		FROM ART_SCRAP S LEFT OUTER JOIN ART_LIKE L 
		ON  S.ARTINFO_NUM = L.ARTINFO_NUM
		WHERE S.ID = 'song'
		GROUP BY S.ARTINFO_NUM, S.ID) A
		JOIN
		(SELECT  S.ARTINFO_NUM, S.ID, COUNT(ART_COMMENT_NUM) ART_COMMENT_COUNT
		FROM ART_SCRAP S LEFT OUTER JOIN ART_COMMENT C
		ON  S.ARTINFO_NUM = C.ART_NUM
		WHERE S.ID = #{userId}
		GROUP BY S.ARTINFO_NUM, S.ID) B
		ON A.ARTINFO_NUM = B.ARTINFO_NUM) COUNT_TABLE
		ON A.ARTINFO_NUM = COUNT_TABLE.ARTINFO_NUM
		ORDER BY COUNT_TABLE.ARTINFO_NUM
		) t1) t2 where r between #{startRnum} and #{endRnum}
		]]>
	</select>	
	
	<select id="artistProfileArtInfoList" resultMap="artistProfileArtInfoList" parameterType="hashmap">
	<![CDATA[
		select * from (   select Rownum r, t1.* from (
					SELECT A.ARTINFO_IMG, COUNT_TABLE.*
					FROM ART_INFO A
					JOIN 
					(SELECT A.ARTINFO_NUM, A.ART_LIKE_COUNT, B.ART_COMMENT_COUNT
					FROM
					(SELECT I.ARTINFO_NUM, COUNT(ART_LIKE_NUM) ART_LIKE_COUNT
					FROM ART_INFO I 
					LEFT OUTER JOIN ART_LIKE L 
					ON  I.ARTINFO_NUM = L.ARTINFO_NUM
					WHERE I.ARTIST_NUM = #{artistNum}
					GROUP BY I.ARTINFO_NUM) A
					JOIN
					(SELECT I.ARTINFO_NUM, COUNT(ART_COMMENT_NUM) ART_COMMENT_COUNT
					FROM ART_INFO I 
					LEFT OUTER JOIN ART_COMMENT C
					ON  I.ARTINFO_NUM = C.ART_NUM
					WHERE I.ARTIST_NUM = #{artistNum}
					GROUP BY I.ARTINFO_NUM) B
					ON A.ARTINFO_NUM = B.ARTINFO_NUM) COUNT_TABLE
					ON A.ARTINFO_NUM = COUNT_TABLE.ARTINFO_NUM
					ORDER BY COUNT_TABLE.ARTINFO_NUM
		) t1) t2 where r between #{startRnum} and #{endRnum}
		]]>
	</select>
	<select id="artInfoDetail" parameterType="_int" resultMap="artInfoDetailRM">
		SELECT * 
		FROM ART_INFO JOIN ARTIST
		USING(ARTIST_NUM)
		WHERE ARTINFO_NUM = #{artinfoNum}
	</select>
	
	<select id="likeCheck" parameterType="hashmap" resultType="_int">
		SELECT count(*)
		FROM ART_LIKE
		WHERE ARTINFO_NUM=#{artinfoNum} AND ID=#{userId}
	</select>	
	
	<insert id="artHeart" parameterType="hashmap">
		INSERT INTO ART_LIKE 
		VALUES(ART_LIKE_SEQ.NEXTVAL, #{artinfoNum}, #{userId})
	</insert>
	
	<delete id="artHeartCancel" parameterType="hashmap">
		DELETE FROM ART_LIKE
		WHERE ARTINFO_NUM=#{artinfoNum} AND ID=#{userId}
	</delete>

	<select id="likeCount" resultType="_int" parameterType="_int">
		SELECT COUNT(ART_LIKE_NUM)
		FROM ART_LIKE 
		WHERE ARTINFO_NUM=#{artinfoNum}
	</select>
	
	<select id="scrapCheck" parameterType="hashmap" resultType="_int">
		SELECT count(*)
		FROM ART_SCRAP
		WHERE ARTINFO_NUM=#{artinfoNum} AND ID=#{userId}
	</select>	
	
	<insert id="artScrap" parameterType="hashmap">
		INSERT INTO ART_SCRAP 
		VALUES(ART_SCRAP_SEQ.NEXTVAL, #{artinfoNum}, #{userId})
	</insert>
	
	<delete id="artScrapCancel" parameterType="hashmap">
		DELETE FROM ART_SCRAP
		WHERE ARTINFO_NUM=#{artinfoNum} AND ID=#{userId}
	</delete>

	<select id="artCommentList" parameterType="_int" resultMap="artCommentRM">
		SELECT M.MEMBER_IMG, C.*
		FROM ART_COMMENT C LEFT OUTER JOIN MEMBER M
		ON C.ID = M.ID
		WHERE C.ART_NUM=#{artinfoNum}
		ORDER BY ART_COMMENT_GROUP, ART_COMMENT_DATE
	</select>
	
	<insert id="artComment" parameterType="hashmap">
		INSERT INTO ART_COMMENT
		VALUES (ART_COMMENT_SEQ.NEXTVAL, #{artComment}, 0, ART_COMMENT_SEQ.CURRVAL,  #{artinfoNum}, #{userId}, SYSDATE)
	</insert>
	
	<insert id="artCoComment" parameterType="hashmap">
		INSERT INTO ART_COMMENT
		VALUES (ART_COMMENT_SEQ.NEXTVAL, #{artComment}, 1, #{artCommentGroup},  #{artinfoNum}, #{userId}, SYSDATE)
	</insert>
	
	<delete id="deleteComment" parameterType="_int">
		DELETE FROM ART_COMMENT WHERE ART_COMMENT_GROUP = #{artCommentGroup}
	</delete>
	
		<delete id="deleteCoComment" parameterType="_int">
		DELETE FROM ART_COMMENT WHERE ART_COMMENT_NUM = #{artCommentNum}
	</delete>
</mapper>